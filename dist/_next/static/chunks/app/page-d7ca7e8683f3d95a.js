(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{2178:function(e,t,a){Promise.resolve().then(a.bind(a,6418))},6418:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return Home}});var n=a(7437),l=a(2265);let csvFileToArray=(e,t)=>{let a="\r\n",n=t.split("\r\n");1===n.length&&(n=t.split("\n"),a="\n");let l=/"/gi,s=n[0].split(";").map(e=>e.toLowerCase().replace(l,"")),i=["Date","D\xe9bit","Cr\xe9dit","Libell\xe9","Solde","Tags"].map(e=>s.indexOf(e.toLowerCase())),r=n[1].split(a).filter(e=>""!==e);r=n.slice(1).filter(e=>""!==e);let o=r.map(e=>{let t=e.split(";").map(e=>e.replace(/['"]+/g,"")),a=t[i[0]].split("/").map(e=>Number.parseFloat(e)),n={date:new Date(a[2],a[1]-1,a[0]),debit:t[i[1]]?-1*Number.parseFloat(t[i[1]].replace(",",".")):void 0,credit:t[i[2]]?Number.parseFloat(t[i[2]].replace(",",".")):void 0,label:t[i[3]],balance:Number.parseFloat(t[i[4]].replace(",",".")),tags:""===t[i[5]]?[]:t[i[5]].split(">")};return n}),c={begin:new Date(o[0].date.getFullYear(),o[0].date.getMonth(),1),end:new Date(o[0].date.getFullYear(),o[0].date.getMonth()+1,0),lines:o,isAggregated:!1};return c};function CSVBankExtractLoader(e){let{files:t,onValuesChange:a}=e,[s,i]=(0,l.useState)([]);return(0,l.useEffect)(()=>{if(t.length>0){i([]);for(let e=0;e<t.length;e++){let a=t[e],n=new FileReader;n.onload=function(e){let t="";null!==e.target&&(t=e.target.result||"");let n=csvFileToArray(a.name,t);i(e=>-1===e.findIndex(e=>e.begin.toLocaleDateString()===n.begin.toLocaleDateString()&&e.end.toLocaleDateString()===n.end.toLocaleDateString())?[...e,n].sort((e,t)=>e.end>t.end?1:-1):[...e])},n.readAsText(a)}}},[t]),(0,l.useEffect)(()=>{a(s)},[s,a]),(0,n.jsx)(n.Fragment,{})}function aggregateByTags(e,t,a){let n={},l=t<0;for(let c=0;c<e.length;c++){var s,i,r,o;let d=e[c],g=""===a?0:d.tags.indexOf(a),u=l?g%d.tags.length:t,p=d.tags[u];p===a&&u<d.tags.length-1?p=d.tags[u+1]:p===a&&u===d.tags.length-1&&(p=l?d.tags[0]:"Undefined"),p in n?(n[p].credit+=null!==(s=d.credit)&&void 0!==s?s:0,n[p].debit+=null!==(i=d.debit)&&void 0!==i?i:0):n[p]={credit:null!==(r=d.credit)&&void 0!==r?r:0,debit:null!==(o=d.debit)&&void 0!==o?o:0,subTags:{}}}return n}function aggregateByDate(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a={};for(let r=0;r<e.length;r++){var n,l,s,i;let o=e[r],c=o.date.toLocaleDateString("fr-FR");t&&(c=c.slice(c.indexOf("/")+1)),c in a?(a[c].credit+=null!==(n=o.credit)&&void 0!==n?n:0,a[c].debit+=null!==(l=o.debit)&&void 0!==l?l:0):a[c]={credit:null!==(s=o.credit)&&void 0!==s?s:0,debit:null!==(i=o.debit)&&void 0!==i?i:0,subTags:{}}}return a}function getAccountPeriodStr(e){let t=e.isAggregated?" (Aggregated) ":"";return e.begin.toLocaleDateString()+" - "+e.end.toLocaleDateString()+t}function extractIdFromLabel(e){return!function(e){let t=new RegExp(/(VIR\s)/),a=t.test(e.toUpperCase());return a}(e)?!function(e){let t=new RegExp(/(PAIEMENT\s)/),a=t.test(e.toUpperCase());return a}(e)?!function(e){let t=new RegExp(/(PRLV\sSEPA\s)/),a=t.test(e.toUpperCase());return a}(e)?!function(e){let t=new RegExp(/(RETRAIT\sDAB\s)/),a=t.test(e.toUpperCase());return a}(e)?e.trim():(function(e){let t=e.toUpperCase().match(/RETRAIT DAB/);return t?t[0]:""})(e).trim():(function(e){let t=e.toUpperCase().match(/(?:PRLV\sSEPA\s)(([a-zA-Z]|-|_|\s)+)/);return t?t[1]:""})(e).trim():(function(e){let t=e.toUpperCase().match(/(?:PAIEMENT\s(?:CB|PSC)\s\d\d\d\d\s)(([a-zA-Z]|-|_|\d+|\/|\*|\s)+)(?:CARTE\s\d\d\d\d)/);return t?t[1]:""})(e).trim():(function(e){let t=e.toUpperCase().match(/(?:VIR\s)(([a-zA-Z]|-|_|\s)+)/);return t?t[1]:""})(e).trim()}function Balance_Balance(e){let{account:t,tag:a}=e,[s,i]=(0,l.useState)(0),[r,o]=(0,l.useState)(0),[c,d]=(0,l.useState)(0);return(0,l.useEffect)(()=>{let e=0,n=0,l=""===a?t.lines:t.lines.filter(e=>-1!==e.tags.indexOf(a));for(let t=0;t<l.length;t++){var s,r;e+=null!==(s=l[t].debit)&&void 0!==s?s:0,n+=null!==(r=l[t].credit)&&void 0!==r?r:0}i(e),o(n),d(t.lines[t.lines.length-1].balance)},[t,a]),(0,n.jsx)("div",{children:(0,n.jsxs)("div",{className:"row",children:[(0,n.jsxs)("div",{className:"column",children:[(0,n.jsx)("h2",{className:"title",children:"Last balance"}),(0,n.jsx)("p",{children:c.toFixed(2)})]}),(0,n.jsxs)("div",{className:"column",children:[(0,n.jsx)("h2",{className:"title",children:"Debit"}),(0,n.jsxs)("p",{children:["-",s.toFixed(2)]})]}),(0,n.jsxs)("div",{className:"column",children:[(0,n.jsx)("h2",{className:"title",children:"Credit"}),(0,n.jsxs)("p",{children:["+",r.toFixed(2)]})]})]})})}function TagList_TagList(e){let{account:t,onTagSelect:a}=e,[s,i]=(0,l.useState)([]),[r,o]=(0,l.useState)("");return(0,l.useEffect)(()=>{let e=function(e){let t=[];for(let a=0;a<e.length;a++)for(let n=0;n<e[a].tags.length;n++){let l=t.findIndex(t=>t.tag===e[a].tags[n]);-1===l?t.push({tag:e[a].tags[n],count:1,frequency:1/e.length}):(t[l].count++,t[l].frequency=t[l].count/e.length)}return t.sort((e,t)=>{let a=Math.floor(100*e.frequency),n=Math.floor(100*t.frequency);return a===n?e.tag>t.tag?1:-1:Math.floor(100*t.frequency)-Math.floor(100*e.frequency)})}(t.lines);i([{tag:"Tous",count:t.lines.length,frequency:1},...e])},[t]),(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{children:" Tags "}),s.map((e,t)=>(0,n.jsx)("button",{id:"btn-"+e.tag,name:"btn-"+e.tag,className:r===e.tag||"Tous"===e.tag&&""===r?"btn-link-selected ":"btn-link ",onClick:()=>{o(0===t?"":s[t].tag),a(0===t?"":s[t].tag)},children:"Tous"===e.tag?e.tag:e.tag+"("+Math.floor(100*e.frequency)+"%)"},"btn-"+e.tag))]})}a(7446),a(6863);var s=a(6704),i=a(105);let r=["rgb(213,62,79)","rgb(244,109,67)","rgb(253,174,97)","rgb(254,224,139)","rgb(255,255,191)","rgb(230,245,152)","rgb(171,221,164)","rgb(102,194,165)","rgb(50,136,189)"],o=["rgba(255, 99, 132, 0.2)","rgba(54, 162, 235, 0.2)","rgba(255, 206, 86, 0.2)","rgba(75, 192, 192, 0.2)","rgba(153, 102, 255, 0.2)","rgba(255, 159, 64, 0.2)"],c=["rgba(255, 99, 132, 1)","rgba(54, 162, 235, 1)","rgba(255, 206, 86, 1)","rgba(75, 192, 192, 1)","rgba(153, 102, 255, 1)","rgba(255, 159, 64, 1)"];function BalanceHistoryChart(e){let{accountLines:t}=e,[a,s]=(0,l.useState)({responsive:!0,animation:{},scales:{},plugins:{}}),[o,c]=(0,l.useState)({labels:[],datasets:[]});return(0,l.useEffect)(()=>{let e=[],a=[];if(1===t.length)e.push(t[0].date.toLocaleDateString("fr-FR")),a.push(t[0].balance);else if(t.length>1){let n=t[0].date;for(let l=1;l<t.length;l++)t[l].date.getTime()!==n.getTime()?(e.push(n.toLocaleDateString("fr-FR")),a.push(t[l-1].balance),n=t[l].date):l===t.length-1&&t[l].date.getTime()===n.getTime()&&(e.push(n.toLocaleDateString("fr-FR")),a.push(t[l-1].balance))}let n=[];n.push({label:"Balance",yAxisID:"y",data:a,backgroundColor:r[0],datalabels:{anchor:"center",align:"bottom"}}),c({labels:e,datasets:n}),s({responsive:!0,maintainAspectRatio:!1,animation:{duration:0},scales:{x:{beginAtZero:!0,title:{display:!0,text:"Date"}},y:{beginAtZero:!0,title:{display:!0,text:"Amount"}}},plugins:{legend:{position:"top"},title:{display:!0,text:"Evolution of the account's balance"},datalabels:{display:!1}}})},[t]),(0,n.jsx)("div",{className:"time-chart-wrapper",children:(0,n.jsx)(i.x1,{options:a,data:o})})}function TagHistoryChart(e){let{accountLines:t,tag:a}=e,[s,o]=(0,l.useState)({responsive:!0,animation:{},scales:{},plugins:{}}),[c,d]=(0,l.useState)({labels:[],datasets:[]});return(0,l.useEffect)(()=>{let e=[],n=""===a?t:t.filter(e=>-1!==e.tags.indexOf(a)),l=aggregateByTags(n,-1,a),s=Object.keys(l),i=aggregateByDate(n),c=Object.keys(i).sort((e,t)=>new Date(parseInt(e.split("/")[2]),parseInt(e.split("/")[1])-1,parseInt(e.split("/")[0]))>new Date(parseInt(t.split("/")[2]),parseInt(t.split("/")[1])-1,parseInt(t.split("/")[0]))?1:-1),g=[];for(let t=0;t<s.length;t++){let a=n.filter(e=>-1!==e.tags.indexOf(s[t])&&!e.tags.some(e=>g.includes(e))),l=aggregateByDate(a),o=Object.keys(i).sort((e,t)=>new Date(parseInt(e.split("/")[2]),parseInt(e.split("/")[1])-1,parseInt(e.split("/")[0]))>new Date(parseInt(t.split("/")[2]),parseInt(t.split("/")[1])-1,parseInt(t.split("/")[0]))?1:-1).map(e=>l[e]?l[e].debit-l[e].credit:0),c={label:s[t],yAxisID:"y",data:o,backgroundColor:r[t%r.length]};e.push(c),g.push(s[t])}d({labels:c,datasets:e}),o({responsive:!0,maintainAspectRatio:!1,animation:{duration:0},scales:{x:{beginAtZero:!0,title:{display:!0,text:"Date"},stacked:!0},y:{beginAtZero:!0,title:{display:!0,text:"Amount"},stacked:!0}},plugins:{legend:{position:"top"},title:{display:!0,text:"Debit history of "+(a||"Tous")},datalabels:{borderRadius:25,borderWidth:2,color:"black",display:e=>{let t=e.dataset.data[e.dataIndex];return 0!==t},formatter:(e,t)=>Math.round(e).toString(),font:{weight:"bold"},padding:6,textAlign:"center"}}})},[t,a]),(0,n.jsx)("div",{className:"time-chart-wrapper",children:(0,n.jsx)(i.$Q,{options:s,data:c})})}s.kL.register(s.f$,s.od,s.jn,s.uw,s.Dx,s.u,s.De),s.kL.register(s.f$,s.uw,s.ZL,s.Dx,s.u,s.De);var d=a(2862);function TagRepartitionChart(e){let{accountLines:t,tag:a}=e,[s,r]=(0,l.useState)({responsive:!0,animation:{},plugins:{}}),[d,g]=(0,l.useState)({labels:[],datasets:[]});return(0,l.useEffect)(()=>{let e=""===a?t:t.filter(e=>-1!==e.tags.indexOf(a)),n=aggregateByTags(e,-1,a),l=Object.keys(n).filter(e=>0!==n[e].debit).sort(),s=l.filter(e=>0!==n[e].debit).map(e=>n[e].debit),i=[];i.push({data:s,backgroundColor:o,borderColor:c,datalabels:{anchor:"end",align:"bottom"}}),g({labels:l,datasets:i}),r({responsive:!0,animation:{duration:0},plugins:{legend:{position:"top"},title:{display:!0,text:"Repartition of "+(a||"Tous")},datalabels:{borderRadius:25,borderWidth:2,color:"black",font:{weight:"bold"},padding:6,formatter:function(e,t){let a=t.chart.data.labels?t.chart.data.labels[t.dataIndex]:"";return a+"\n"+Math.round(e).toString()},textAlign:"center"}}})},[t,a]),(0,n.jsx)("div",{className:"pie-chart-wrapper",children:(0,n.jsx)(i.by,{options:s,data:d})})}function TagHistoryMonthlyChart(e){let{accountLines:t,tag:a}=e,[s,o]=(0,l.useState)({responsive:!0,animation:{},scales:{},plugins:{}}),[c,d]=(0,l.useState)({labels:[],datasets:[]});return(0,l.useEffect)(()=>{let e=[],n=""===a?t:t.filter(e=>-1!==e.tags.indexOf(a)),l=aggregateByTags(n,-1,a),s=Object.keys(l),i=aggregateByDate(n,!0),c=Object.keys(i).sort((e,t)=>new Date(2023,parseInt(e.split("/")[1])-1,parseInt(e.split("/")[0]))>new Date(2023,parseInt(t.split("/")[1])-1,parseInt(t.split("/")[0]))?1:-1),g={label:a||"Tous",yAxisID:"y",data:Object.keys(i).sort((e,t)=>new Date(2023,parseInt(e.split("/")[1])-1,parseInt(e.split("/")[0]))>new Date(2023,parseInt(t.split("/")[1])-1,parseInt(t.split("/")[0]))?1:-1).map(e=>i[e]?i[e].debit:0),backgroundColor:r[0]};e.push(g);let u=[];for(let t=0;t<s.length;t++){let a=n.filter(e=>-1!==e.tags.indexOf(s[t])&&!e.tags.some(e=>u.includes(e))),l=aggregateByDate(a,!0),o=Object.keys(i).sort((e,t)=>new Date(2023,parseInt(e.split("/")[1])-1,parseInt(e.split("/")[0]))>new Date(2023,parseInt(t.split("/")[1])-1,parseInt(t.split("/")[0]))?1:-1).map(e=>l[e]?l[e].debit:0),c={label:s[t],yAxisID:"y",data:o,backgroundColor:r[(t+1)%r.length]};e.push(c),u.push(s[t])}d({labels:c,datasets:e}),o({responsive:!0,maintainAspectRatio:!1,animation:{duration:0},scales:{x:{beginAtZero:!0,title:{display:!0,text:"Date"}},y:{beginAtZero:!0,title:{display:!0,text:"Amount"}}},plugins:{legend:{position:"top"},title:{display:!0,text:"Debit monthly history of "+(a||"Tous")},datalabels:{align:"end",anchor:"end",color:"black",display:e=>{let t=e.dataset.data[e.dataIndex];return t>0},formatter:(e,t)=>Math.round(e).toString(),font:{weight:"bold"},padding:6,textAlign:"center"}}})},[t,a]),(0,n.jsx)("div",{className:"time-chart-wrapper",children:(0,n.jsx)(i.$Q,{options:s,data:c})})}function AccountList_AccountList(e){let{periods:t,onAccountSelect:a}=e,[s,i]=(0,l.useState)(0);return(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{children:"Available Periods"}),(0,n.jsx)("div",{className:"vertical-menu",children:t.map((e,l)=>{let r=e.lines.filter(e=>0===e.tags.length).length;return(0,n.jsxs)("button",{id:"btn-"+getAccountPeriodStr(e),name:"btn-"+getAccountPeriodStr(e),className:s===l?"btn-link-selected vertical-menu":"btn-link vertical-menu",onClick:()=>{i(l),a(t[l])},children:[getAccountPeriodStr(e)," ",r>0?"(lines to tag "+r+")":""]},"btn-"+getAccountPeriodStr(e))})})]})}s.kL.register(s.qi,s.Dx,s.u,s.De,d.Z),s.kL.register(s.f$,s.od,s.jn,s.uw,s.ZL,s.Dx,s.u,s.De),a(9656);var g=a(5183);function ExportMapping(e){let{periods:t}=e,[a,s]=(0,l.useState)([]);return(0,l.useEffect)(()=>{let e={};for(let a=0;a<t.length;a++){let n=t[a].lines;for(let t=0;t<n.length;t++){let a=n[t].label,l=extractIdFromLabel(a);if(""===l){console.warn("ID not found for "+a);continue}let s=n[t].tags.join(">");Object.keys(e).includes(l)||""===s?Object.keys(e).includes(l)&&s!==e[l]&&""!==s&&console.log("Found different tags "+s+" for "+l+" than "+e[l]+" in label "+a):e[l]=s}}let a=[];Object.keys(e).forEach(t=>{let n={id:t,tags:e[t]};a.push(n)}),s(a)},[t]),(0,n.jsx)(g.CSVLink,{data:a,headers:[{label:"Match",key:"id"},{label:"Tags",key:"tags"}],separator:";",filename:"mapping_labels_tags.csv",children:"Download Account-Tags mapping"})}function MappingExtractLoader(e){let{files:t,onValuesChange:a}=e,[s,i]=(0,l.useState)({}),r=(0,l.useCallback)(e=>{i({});for(let t=0;t<e.length;t++){let a=e[t],n=new FileReader;n.onload=function(e){let t="";null!==e.target&&(t=e.target.result||""),csvFileToArray(a.name,t)},n.readAsText(a)}},[]),csvFileToArray=(e,t)=>{let a=t.split("\n"),n=/"/gi,l=a[0].split(";").map(e=>e.toLowerCase().replace(n,"")),s=["Match","Tags"].map(e=>l.indexOf(e.toLowerCase())),r=a[1].split("\n").filter(e=>""!==e);r=a.slice(1).filter(e=>""!==e);let o=r.map(e=>{let t=e.split(";").map(e=>e.replace(/['"]+/g,"")),a={match:t[s[0]],tags:t[s[1]]};return a}),c={};for(let e=0;e<o.length;e++)c[o[e].match]=o[e].tags;i(c)};return(0,l.useEffect)(()=>{t.length>0&&(console.log("load csv files: "+t),r(t))},[t,r]),(0,l.useEffect)(()=>{a(s)},[s,a]),(0,n.jsx)(n.Fragment,{})}function ExportTaggedCSV(e){let{periods:t}=e,[a,s]=(0,l.useState)([]),i=(0,l.useMemo)(()=>[{label:"Date",key:"date"},{label:"Date de valeur",key:"valueDate"},{label:"D\xe9bit",key:"debit"},{label:"Cr\xe9dit",key:"credit"},{label:"Libell\xe9",key:"label"},{label:"Solde",key:"balance"},{label:"Tags",key:"tags"}],[]);return(0,l.useEffect)(()=>{console.log("Export Tagged CSv");let e=[];for(let a=0;a<t.length;a++){let n=t[a].lines;for(let t=0;t<n.length;t++){let a=n[t],l={date:a.date.toLocaleDateString("fr-FR"),valueDate:a.date.toLocaleDateString("fr-FR"),debit:a.debit?(-1*a.debit).toLocaleString("fr-FR").replace(" ",""):"",credit:a.credit?a.credit.toLocaleString("fr-FR").replace(" ",""):"",label:a.label,balance:a.balance.toLocaleString("fr-FR").replace(" ",""),tags:a.tags.join(">")};e.push(l)}}s(e)},[t,i]),(0,n.jsx)(g.CSVLink,{data:a,headers:i,separator:";",filename:"tagged_account.csv",children:"Download tagged account"})}function Lines(e){let{accountLines:t,tag:a}=e,[s,i]=(0,l.useState)([]);return(0,l.useEffect)(()=>{let e=""===a?t:t.filter(e=>-1!==e.tags.indexOf(a));i(e)},[t,a]),(0,n.jsx)("div",{children:(0,n.jsxs)("table",{children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{children:" Date "}),(0,n.jsx)("th",{children:" Label "}),(0,n.jsx)("th",{children:" Debit "}),(0,n.jsx)("th",{children:" Credit "})]})}),(0,n.jsx)("tbody",{children:s.map((e,t)=>{var a,l;return(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:e.date.toLocaleString("fr-FR",{year:"numeric",month:"numeric",day:"numeric"})},"td-date"+t),(0,n.jsx)("td",{children:e.label},"td-label"+t),(0,n.jsx)("td",{children:null===(a=e.debit)||void 0===a?void 0:a.toFixed(2)},"td-debit"+t),(0,n.jsx)("td",{children:null===(l=e.credit)||void 0===l?void 0:l.toFixed(2)},"td-credit"+t)]},"tr-"+t)})})]})})}function AccountFilesSelector(e){let{files:t,formId:a,handleSelection:s}=e,[i,r]=(0,l.useState)([]);return(0,n.jsx)("div",{id:"div-"+a,style:{lineHeight:"200%"},children:t.length>0&&(0,n.jsxs)(n.Fragment,{children:[t.map((e,t)=>(0,n.jsxs)("div",{children:[(0,n.jsx)("input",{name:"check-file-"+a+"-"+t,type:"checkbox",id:"check-file-"+a+"-"+t,onChange:t=>{t.currentTarget.checked?r(t=>[...t,e]):r(t=>{let a=t.map(e=>e.id).indexOf(e.id),n=[...t];return n.splice(a,1),n})}}),(0,n.jsx)("label",{style:{wordBreak:"break-all"},htmlFor:"check-file-"+a+"-"+t,children:e.name})]},"div-select-files-"+a+"-"+t)),(0,n.jsx)("div",{children:(0,n.jsx)("button",{type:"submit",id:"button-"+a,onClick:()=>{s(i)},className:"button-18",children:"Load files"})})]})})}function GoogleCSVUploader(e){let{searchMapping:t,handleFiles:a}=e,[s,i]=(0,l.useState)([]),getAccountFolderId=async()=>{let e;try{e=await gapi.client.drive.files.list({pageSize:2,corpora:"user",includeItemsFromAllDrives:!0,supportsAllDrives:!0,orderBy:"name",q:"name='Comptes' and mimeType = 'application/vnd.google-apps.folder'",fields:"files(id, name)"})}catch(e){return console.error(e),""}let t=e.result.files;return t&&0!=t.length?t.length>1?(console.warn("Too many folders found"),""):t[0].id:(console.warn("No files found"),"")},r=(0,l.useCallback)(async e=>{let a;try{a=await gapi.client.drive.files.list({pageSize:10,corpora:"user",includeItemsFromAllDrives:!0,supportsAllDrives:!0,orderBy:"name",q:t?"'"+e+"' in parents and mimeType='text/csv' and name contains 'mapping'":"'"+e+"' in parents and mimeType='text/csv' and not name contains 'mapping'",fields:"files(id, name)"})}catch(e){console.error(e);return}let n=a.result.files;if(!n||0==n.length){console.warn("No files found");return}i(n)},[t]),getCSVFileContent=async e=>{let t;console.log("Get content for id "+e.id+", name: "+e.name);try{t=await gapi.client.drive.files.get({fileId:e.id,supportAllDrives:!0,alt:"media"})}catch(e){console.error(e);return}console.log(JSON.stringify(t.body));let a=t.body,n=new Blob([a]),l=new File([n],e.name);return l},handleSelection=async e=>{let n=[];console.log("Handle Selection: "+JSON.stringify(e));for(let t=0;t<e.length;t++){console.log("Get: "+JSON.stringify(e[t]));let a=await getCSVFileContent(e[t]);a&&n.push(a)}console.log("All files have been loaded"),a(n,t)};return(0,l.useEffect)(()=>{getAccountFolderId().then(e=>{r(e)})},[r]),(0,n.jsx)(AccountFilesSelector,{formId:t?"load-mapping":"load-account",files:s,handleSelection:handleSelection})}function CSVUploader_CSVUploader(e){let{searchMapping:t,formId:a,actionLabel:s,handleFiles:i}=e,r=(0,l.useRef)(null);return(0,n.jsx)("div",{style:{marginLeft:5,marginRight:5,marginTop:5,marginBottom:32},children:(0,n.jsxs)("form",{children:[(0,n.jsx)("label",{htmlFor:a,className:"button-18",children:s}),(0,n.jsx)("input",{type:"file",id:a,accept:".csv",onChange:e=>{var a;let n=(null===(a=e.currentTarget.files)||void 0===a?void 0:a.length)||0;console.log(e.currentTarget.files);let l=[];if(e.currentTarget.files)for(let t=0;t<n;t++)console.log("handleOnChange: "+e.currentTarget.files[t]),l.push(e.currentTarget.files[t]);console.log("CSV Uploaded nb files: "+l.length),i(l,t)},multiple:!0,ref:r,style:{display:"none"}})]})})}a(4516);var u=a(8475),p=a.n(u);function GoogleLogin(e){let{CLIENT_ID:t,API_KEY:a,DISCOVERY_DOC:s,SCOPES:i,onChange:r}=e,[o,c]=(0,l.useState)(!1),[d,g]=(0,l.useState)(!1),[u,h]=(0,l.useState)({}),[f,b]=(0,l.useState)(!0),[m,x]=(0,l.useState)([]);(0,l.useEffect)(()=>{r(f)},[f,r]);let initializeGapiClient=async()=>{await gapi.client.init({apiKey:a,discoveryDocs:[s]}),console.log("Client API initialized"),g(!0)},getAccountFolderId=async()=>{let e;try{e=await gapi.client.drive.files.list({pageSize:2,corpora:"user",includeItemsFromAllDrives:!0,supportsAllDrives:!0,orderBy:"name",q:"name='Comptes' and mimeType = 'application/vnd.google-apps.folder'",fields:"files(id, name)"})}catch(e){return console.error(e),""}let t=e.result.files;return t&&0!=t.length?t.length>1?(console.warn("Too many folders found"),""):t[0].id:(console.warn("No files found"),"")},listFilesInFolder=async e=>{let t;try{t=await gapi.client.drive.files.list({pageSize:10,corpora:"user",includeItemsFromAllDrives:!0,supportsAllDrives:!0,orderBy:"name",q:"'"+e+"' in parents and mimeType='text/csv'",fields:"files(id, name)"})}catch(e){console.error(e);return}let a=t.result.files;if(!a||0==a.length){console.warn("No files found");return}x(a)};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(p(),{async:!0,defer:!0,src:"https://accounts.google.com/gsi/client",onLoad:()=>{let e=google.accounts.oauth2.initTokenClient({client_id:t,scope:i,callback:""});console.log("Token: "+JSON.stringify(e)),h(e),c(!0)},strategy:"lazyOnload"}),(0,n.jsx)(p(),{src:"https://apis.google.com/js/api.js",onLoad:()=>{gapi.load("client",initializeGapiClient)},strategy:"lazyOnload"}),(0,n.jsx)("div",{hidden:!(o&&d)||!f,children:(0,n.jsx)("button",{id:"btn-google-authent",name:"btn-google-authent",className:"button-18",onClick:()=>{u.callback=async e=>{if(void 0!==e.error)throw e;getAccountFolderId().then(e=>{listFilesInFolder(e)}),b(!1)},null===gapi.client.getToken()?u.requestAccessToken({prompt:"consent"}):u.requestAccessToken({prompt:""})},children:"Login"})}),(0,n.jsx)("div",{hidden:f,children:(0,n.jsx)("button",{id:"btn-google-logout",name:"btn-google-logout",className:"button-18",onClick:()=>{let e=gapi.client.getToken();null!==e&&(google.accounts.oauth2.revoke(e.access_token),gapi.client.setToken(""),b(!0))},children:"Logout"})})]})}function Home(){let[e,t]=(0,l.useState)(!0),[a,s]=(0,l.useState)(!1),[i,r]=(0,l.useState)([]),[o,c]=(0,l.useState)([]),[d,g]=(0,l.useState)(!1),[u,p]=(0,l.useState)(!1),[h,f]=(0,l.useState)(!1),[b,m]=(0,l.useState)(!1),[x,y]=(0,l.useState)(!1),[j,v]=(0,l.useState)([]),[S,C]=(0,l.useState)(""),[L,k]=(0,l.useState)({begin:new Date,end:new Date,lines:[],isAggregated:!1}),[D,A]=(0,l.useState)({}),[F,T]=(0,l.useState)([]),[w,I]=(0,l.useState)("charts"),E=(0,l.useCallback)(e=>{if(console.log("loaded : "+e.length),e.length>0){let t=function(e){let t=e.reduce((e,t)=>({...e,begin:t.begin<e.begin?t.begin:e.begin,end:t.begin>e.begin?t.begin:e.begin,lines:[...e.lines,...t.lines],isAggregated:!0}));return t.lines.sort((e,t)=>e.date>t.date?1:-1),t}(e);v([t,...e]),k(t)}},[]),N=(0,l.useCallback)(e=>{if(e.length>0){let t=function(e,t){let a=[...e];for(let e=0;e<a.length;e++){let n=a[e];for(let e=0;e<n.lines.length;e++){let a=n.lines[e],l=extractIdFromLabel(a.label);t[l]&&(a.tags=t[l].split(">"))}}return a}(e,D);T(t)}},[D]);(0,l.useEffect)(()=>{j.length>0&&f(!0),Object.keys(D).length>0&&m(!0),F.length>0&&y(!0)},[j,D,F]);let handleLoadedFiles=(e,t)=>{console.log("Loaded files : "+e),t?(c(e),p(!0)):(r(e),g(!0))},handleLocalLoadedFiles=(e,t)=>{s(!0),handleLoadedFiles(e,t)};return(0,n.jsxs)("div",{className:"gridLayout",children:[(0,n.jsxs)("div",{className:"leftColumn",children:[!a&&(0,n.jsxs)("div",{className:"section-wrapper",children:[(0,n.jsx)("p",{children:"Load from Google Drive"}),(0,n.jsx)(GoogleLogin,{CLIENT_ID:"983498276769-rvir7h8fu2g1bjt6d8g4n3qkohca4c9q.apps.googleusercontent.com",API_KEY:"AIzaSyDzBUKG-QkH4W7z0h4eR9-UtC0CyCyJy60",SCOPES:"https://www.googleapis.com/auth/drive",DISCOVERY_DOC:"https://www.googleapis.com/discovery/v1/apis/drive/v3/rest",onChange:e=>t(e)})]}),!e&&(0,n.jsxs)(n.Fragment,{children:[!u&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"section-wrapper",children:[(0,n.jsx)("p",{children:"Accounts"}),(0,n.jsx)(GoogleCSVUploader,{handleFiles:handleLoadedFiles,searchMapping:!1})]}),!d&&(0,n.jsxs)("div",{className:"section-wrapper",children:[(0,n.jsx)("p",{children:"Mappings"}),(0,n.jsx)(GoogleCSVUploader,{handleFiles:handleLoadedFiles,searchMapping:!0})]})]}),d&&!u&&(0,n.jsx)(CSVBankExtractLoader,{idExtract:"A",onValuesChange:E,files:i}),u&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(MappingExtractLoader,{onValuesChange:A,files:o}),(0,n.jsx)(GoogleCSVUploader,{handleFiles:handleLoadedFiles,searchMapping:!1}),(0,n.jsx)(CSVBankExtractLoader,{idExtract:"B",onValuesChange:N,files:i})]})]}),e&&(0,n.jsxs)("div",{className:"section-wrapper",children:[(0,n.jsx)("p",{children:"Load from computer"}),!u&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(CSVUploader_CSVUploader,{handleFiles:handleLocalLoadedFiles,searchMapping:!1,formId:"load-accounts",actionLabel:"Load Accounts"}),!d&&(0,n.jsx)(CSVUploader_CSVUploader,{handleFiles:handleLocalLoadedFiles,searchMapping:!0,formId:"load-mapping",actionLabel:"Load Mapping"})]}),d&&!u&&(0,n.jsx)(CSVBankExtractLoader,{idExtract:"C",onValuesChange:E,files:i}),u&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(MappingExtractLoader,{onValuesChange:A,files:o}),(0,n.jsx)(CSVUploader_CSVUploader,{handleFiles:handleLoadedFiles,searchMapping:!1,formId:"load-accounts",actionLabel:"Load accounts to tag"}),(0,n.jsx)(CSVBankExtractLoader,{idExtract:"D",onValuesChange:N,files:i})]})]}),x&&(0,n.jsx)("div",{className:"section-wrapper",children:(0,n.jsx)(ExportTaggedCSV,{periods:F})}),h&&(0,n.jsxs)("div",{className:"section-wrapper",children:[(0,n.jsx)(ExportMapping,{periods:j}),(0,n.jsx)(AccountList_AccountList,{periods:j,onAccountSelect:k}),(0,n.jsx)(TagList_TagList,{account:L,onTagSelect:C})]})]}),h&&(0,n.jsxs)("div",{children:[(0,n.jsx)(Balance_Balance,{account:L,tag:S}),(0,n.jsxs)("div",{children:[(0,n.jsx)("button",{id:"btn-display-charts",name:"btn-display-charts",className:"charts"===w?"btn-link-selected ":"btn-link ",onClick:()=>{I("charts")},children:"Display charts"}),(0,n.jsx)("button",{id:"btn-display-lines",name:"btn-display-lines",className:"lines"===w?"btn-link-selected ":"btn-link ",onClick:()=>{I("lines")},children:"Display account lines"})]}),"charts"===w&&(0,n.jsxs)("div",{children:[""===S&&(0,n.jsxs)("div",{children:[(0,n.jsx)(BalanceHistoryChart,{accountLines:L.lines}),(0,n.jsx)(TagRepartitionChart,{accountLines:L.lines,tag:S})]}),""!==S&&(0,n.jsxs)("div",{children:[(0,n.jsx)(TagHistoryMonthlyChart,{accountLines:L.lines,tag:S}),(0,n.jsx)(TagHistoryChart,{accountLines:L.lines,tag:S}),(0,n.jsx)(TagRepartitionChart,{accountLines:L.lines,tag:S})]})]}),"lines"===w&&(0,n.jsx)(Lines,{accountLines:L.lines,tag:S})]})]})}},9656:function(){},7446:function(){},6863:function(){},4516:function(){}},function(e){e.O(0,[674,917,971,472,744],function(){return e(e.s=2178)}),_N_E=e.O()}]);